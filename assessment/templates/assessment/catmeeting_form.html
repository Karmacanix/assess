{% extends "site-base.html" %}

{% load static %}
{% load account %}
{% load i18n %}

{% block head_title %}{% trans "CAT Meeting Form" %}{% endblock %}

{% block extra_head %}{{ form.media.css }}{% endblock %}

{% block content %}
<div class="w3-container w3-margin-top">
  <header class="w3-black w3-opacity w3-padding-16">
    <h1 class="w3-margin">CAT Meeting Form</h1>
  </header>
  <br>
  <div class="w3-row">
    <form class="w3-container w3-card-4" action="" method="post"><br>
      {% csrf_token %}
      {% for field in form %}
        <div class="w3-row w3-padding">
          <div class="w3-col m1 l1">{{ field.label }}</div>
          <div class="w3-col m3 l3">{{ field }}</div>
        </div>
      {% endfor %}
      
    </form>
  </div>
  <br>
  {% if ready_for_cat_list %}
    <h3>Decisions</h3>
    <table class="w3-table-all w3-hoverable w3-small w3-card-4">
      <thead>
        <tr class="w3-light-grey">
          <th>{% trans "Name" %}</th>
          <th>{% trans "Requestor" %}</th>
          <th>{% trans "Business Owner" %}</th>
          <th>{% trans "DHB(s)" %}</th>
          <th>{% trans "Submitted on" %}</th>
          <th>{% trans "Approve / Reject" %}</th>
          <th>{% trans "Noted" %}</th>
          <th>{% trans "Escalate to IPSG" %}</th>
          <th>{% trans "Next CAT meeting" %}</th>
        </tr>
      </thead>
      <tbody>
        {% for application in ready_for_cat_list %}
        <tr>
          <td><a class="w3-text-indigo" href="{% url 'assessment:application-detail' application.name %}">{{ application.name }}</a></td>
          <td>{{ application.requestor }}</td>
          <td>{{ application.business_owner }}</td>
          <td>{% for dhb in application.dhbs.all %}
            {{ dhb.name }}{% if forloop.last %}.{% else %},{% endif %}
          {% endfor %}</td>
          <td>{{ business_owner_date }}</td>
          <td>
            <select class="w3-select w3-border" id="CATdecision" name="option">
              <option value="" disabled selected>Choose your option</option>
              <option value="1">Approve</option>
              <option value="2">Reject</option>
            </select>
          </td>
          <td><input class="w3-check" type="checkbox" id="noted"></td>
          <td><input class="w3-check" type="checkbox" id="escalate"></td>
          <td><input class="w3-check" type="checkbox" id="next"></td>
         </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No applications are ready for the CAT team!</p>
  {% endif %}
  <br>
  <div class="w3-row">
        {% if catmeeting %}
          <a class="w3-button w3-section w3-red w3-ripple w3-large" href="{% url 'assessment:catmeeting-detail' catmeeting.id %}">{% trans "Cancel" %}</a>
        {% else %}
          <a class="w3-button w3-section w3-red w3-ripple w3-large" href="{% url 'assessment:catmeeting-list' %}">{% trans "Cancel" %}</a>
        {% endif %}
        <button class="primaryAction w3-button w3-section w3-green w3-ripple w3-large" type="submit">{% trans "Save" %}</button>
      </div>
</div>
{% endblock %}

{% block extra_body %}
  {{ form.media.js }}
{% endblock %}